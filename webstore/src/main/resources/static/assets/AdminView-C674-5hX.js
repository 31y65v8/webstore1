import{_ as D,r as i,c as r,a as e,F as E,e as B,f as k,g as s,t as m,b as f,j as _,w as b,v as C,h as Z,o as $,u as ee,k as L}from"./index-CyoWKuPL.js";const le=["disabled"],oe={key:0,class:"loading"},te={key:1,class:"report-table"},se={__name:"CategoriesSalesReport",setup(w){const l=i([]),g=i(!1),o=async()=>{var S,c;g.value=!0;try{const a=localStorage.getItem("token"),p=await k.get("/api/admin/category-sales-report",{headers:{Authorization:`Bearer ${a}`}});p.data.code===200||Array.isArray(p.data)?l.value=p.data.data||p.data:alert("获取报表失败: "+(p.data.msg||"未知错误"))}catch(a){alert("获取报表失败: "+(((c=(S=a.response)==null?void 0:S.data)==null?void 0:c.msg)||a.message))}finally{g.value=!1}};return o(),(S,c)=>(s(),r("div",null,[c[1]||(c[1]=e("h2",null,"商品类别销售报表",-1)),e("button",{onClick:o,disabled:g.value},"刷新报表",8,le),g.value?(s(),r("div",oe,"加载中...")):(s(),r("table",te,[c[0]||(c[0]=e("thead",null,[e("tr",null,[e("th",null,"类别"),e("th",null,"商品数"),e("th",null,"总销量"),e("th",null,"销售额"),e("th",null,"总库存"),e("th",null,"售罄商品数")])],-1)),e("tbody",null,[(s(!0),r(E,null,B(l.value,a=>(s(),r("tr",{key:a.category},[e("td",null,m(a.category),1),e("td",null,m(a.productCount),1),e("td",null,m(a.totalQuantity),1),e("td",null,m(a.totalSales),1),e("td",null,m(a.totalStock),1),e("td",null,m(a.soldOutCount),1)]))),128))])]))]))}},ae=D(se,[["__scopeId","data-v-0d817d92"]]),ne=["disabled"],re={key:0,class:"loading"},de={key:1,class:"trend-table"},ie={key:0,style:{color:"red"}},ue={key:1},ce={__name:"ProductSalesTrend",setup(w){const l=i([]),g=i(!1),o=async()=>{g.value=!0;try{const S=localStorage.getItem("token"),c=await k.get("/api/admin/product-sales-trend",{headers:{Authorization:`Bearer ${S}`}});l.value=c.data.data||c.data}finally{g.value=!1}};return o(),(S,c)=>(s(),r("div",null,[c[1]||(c[1]=e("h2",null,"商品销售趋势与异常监控",-1)),e("button",{onClick:o,disabled:g.value},"刷新",8,ne),g.value?(s(),r("div",re,"加载中...")):(s(),r("table",de,[c[0]||(c[0]=e("thead",null,[e("tr",null,[e("th",null,"商品名称"),e("th",null,"近12月销量"),e("th",null,"预测下月"),e("th",null,"趋势"),e("th",null,"本月销量"),e("th",null,"异常")])],-1)),e("tbody",null,[(s(!0),r(E,null,B(l.value,a=>(s(),r("tr",{key:a.productId},[e("td",null,m(a.productName),1),e("td",null,m(a.monthlySales.join(",")),1),e("td",null,m(a.nextMonthPrediction.toFixed(2)),1),e("td",null,m(a.trend),1),e("td",null,m(a.currentMonthSales),1),e("td",null,[a.isAnomaly?(s(),r("span",ie,"异常")):(s(),r("span",ue,"正常"))])]))),128))])]))]))}},me=D(ce,[["__scopeId","data-v-8fae493f"]]),ge={components:{CategoriesSalesReport:ae,ProductSalesTrend:me},setup(){const w=ee(),l=i([]),g=i(!1),o=i(!1),S=i(""),c=i(!1),a=i(!1),p=i(!1),h=i(null),y=i(""),P=i(!1),t=i(null),T=i([]),A=i(!1),V=i(!1),x=i(!1),z=i(!1),I=i({username:"",password:"",registerEmail:"",registerPhone:"",role:"SELLER"}),U=Z(()=>{if(!S.value)return l.value;const n=S.value.toLowerCase();return l.value.filter(d=>d.username.toLowerCase().includes(n)||d.registerEmail&&d.registerEmail.toLowerCase().includes(n)||d.registerPhone&&d.registerPhone.includes(n))}),Q=()=>{w.push("/api/admin/reports")},F=()=>{o.value=!0,M()},N=()=>{w.push("/admin/report/sellers")},j=()=>{w.push("/admin/report/categories")},q=()=>{w.push("/admin/report/products")},O=()=>{w.push("/admin/report/userprofile")},M=async()=>{g.value=!0;try{const n=localStorage.getItem("token"),d=await k.get("/api/admin/getAllSellers",{headers:{Authorization:`Bearer ${n}`}});d.data.code===200?l.value=d.data.data||[]:console.error("获取销售人员失败:",d.data.msg)}catch(n){console.error("获取销售人员错误:",n)}finally{g.value=!1}},G=n=>{h.value=n,y.value="",a.value=!0},H=n=>{h.value=n,p.value=!0},J=async()=>{var n,d;try{const u=localStorage.getItem("token"),v=await k.post("/api/admin/addSeller",I.value,{headers:{Authorization:`Bearer ${u}`}});v.data.code===200?(c.value=!1,I.value={username:"",password:"",registerEmail:"",registerPhone:"",role:"SELLER"},M()):alert("添加销售人员失败: "+v.data.msg)}catch(u){console.error("添加销售人员错误:",u),alert("添加销售人员失败: "+(((d=(n=u.response)==null?void 0:n.data)==null?void 0:d.msg)||u.message))}},K=async()=>{var n,d;if(!y.value){alert("请输入新密码");return}try{const u=localStorage.getItem("token"),v=await k.post("/api/admin/updateSellerPassword",null,{params:{userId:h.value.id,newpassword:y.value},headers:{Authorization:`Bearer ${u}`}});v.data.code===200?(a.value=!1,alert("密码重置成功")):alert("密码重置失败: "+v.data.msg)}catch(u){console.error("密码重置错误:",u),alert("密码重置失败: "+(((d=(n=u.response)==null?void 0:n.data)==null?void 0:d.msg)||u.message))}},W=async()=>{var n,d;try{const u=localStorage.getItem("token"),v=await k.post("/api/user/deleteseller/{userId}",null,{params:{userId:h.value.id},headers:{Authorization:`Bearer ${u}`}});v.data.code===200?(p.value=!1,M()):alert("删除销售人员失败: "+v.data.msg)}catch(u){console.error("删除销售人员错误:",u),alert("删除销售人员失败: "+(((d=(n=u.response)==null?void 0:n.data)==null?void 0:d.msg)||u.message))}},X=n=>n?new Date(n).toLocaleString():"-",Y=async n=>{var d,u;P.value=!0,t.value=n,A.value=!0;try{const v=localStorage.getItem("token"),R=await k.get("/api/admin/seller-category-report",{params:{sellerId:n},headers:{Authorization:`Bearer ${v}`}});R.data.code===200||Array.isArray(R.data)?T.value=R.data.data||R.data:alert("获取销售报表失败: "+(R.data.msg||"未知错误"))}catch(v){alert("获取销售报表失败: "+(((u=(d=v.response)==null?void 0:d.data)==null?void 0:u.msg)||v.message))}finally{A.value=!1}};return $(()=>{w.currentRoute.value.path==="/admin/sellers"&&(o.value=!0,M())}),{sellers:l,loading:g,showSellerManagement:o,searchQuery:S,filteredSellers:U,showAddSellerModal:c,showPasswordResetModal:a,showDeleteSellerModal:p,selectedSeller:h,newPassword:y,newSeller:I,goToReports:Q,goToSellerManagement:F,goToSellerSalesReport:N,goToProductSalesTrend:q,showSellerList:z,showPasswordModal:G,showDeleteModal:H,addSeller:J,resetPassword:K,deleteSeller:W,formatDate:X,showSalesReport:P,selectedSellerId:t,salesReport:T,loadingSalesReport:A,fetchSalesReport:Y,showCategoriesSalesReport:V,goToCategoriesSalesReport:j,showProductSalesTrend:x,goToUserProfile:O}}},ve={class:"admin-container"},Se={class:"admin-menu"},pe={key:0,class:"seller-management"},we={class:"actions"},fe={key:0,class:"loading"},he={key:1,class:"empty-state"},ye={key:2,class:"seller-table"},ke={class:"actions-cell"},be=["onClick"],Ce=["onClick"],Pe={key:1,class:"modal"},Re={class:"modal-content"},Te={class:"form-group"},Me={class:"form-group"},Ae={class:"form-group"},Ie={class:"form-group"},_e={class:"modal-actions"},Le={key:2,class:"modal"},De={class:"modal-content"},Ee={class:"form-group"},Be={class:"modal-actions"},Ve={key:3,class:"modal"},xe={class:"modal-content"},ze={class:"modal-actions"};function Ue(w,l,g,o,S,c){var y,P;const a=L("SellerList"),p=L("CategoriesSalesReport"),h=L("ProductSalesTrend");return s(),r("div",ve,[l[38]||(l[38]=e("h1",null,"管理控制台",-1)),e("div",Se,[e("div",{class:"menu-card",onClick:l[0]||(l[0]=(...t)=>o.goToSellerManagement&&o.goToSellerManagement(...t))},l[24]||(l[24]=[e("i",{class:"icon user-icon"},null,-1),e("h3",null,"销售人员管理",-1),e("p",null,"管理销售人员、修改销售人员口令",-1)])),e("div",{class:"menu-card",onClick:l[1]||(l[1]=(...t)=>o.goToSellerSalesReport&&o.goToSellerSalesReport(...t))},l[25]||(l[25]=[e("i",{class:"icon chart-icon"},null,-1),e("h3",null,"销售人员销售报表",-1),e("p",null,"查看销售人员负责的各类别商品的销量等统计",-1)])),o.showSellerList?(s(),_(a,{key:0,onViewReport:o.fetchSalesReport},null,8,["onViewReport"])):f("",!0),e("div",{class:"menu-card",onClick:l[2]||(l[2]=(...t)=>o.goToCategoriesSalesReport&&o.goToCategoriesSalesReport(...t))},l[26]||(l[26]=[e("i",{class:"icon chart-icon"},null,-1),e("h3",null,"商品类别销售报表",-1),e("p",null,"查看各类别商品的销量、库存等统计",-1)])),e("div",{class:"menu-card",onClick:l[3]||(l[3]=(...t)=>o.goToProductSalesTrend&&o.goToProductSalesTrend(...t))},l[27]||(l[27]=[e("i",{class:"icon chart-icon"},null,-1),e("h3",null,"商品销售趋势与异常",-1),e("p",null,"查看商品销售趋势预测与异常监控",-1)]))]),o.showSellerManagement?(s(),r("div",pe,[l[29]||(l[29]=e("h2",null,"销售人员管理",-1)),e("div",we,[e("button",{class:"add-btn",onClick:l[4]||(l[4]=t=>o.showAddSellerModal=!0)},"新增销售人员"),b(e("input",{"onUpdate:modelValue":l[5]||(l[5]=t=>o.searchQuery=t),placeholder:"搜索销售人员...",class:"search-input"},null,512),[[C,o.searchQuery]])]),o.loading?(s(),r("div",fe,"加载中...")):o.sellers.length===0?(s(),r("div",he," 暂无销售人员 ")):(s(),r("table",ye,[l[28]||(l[28]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"用户名"),e("th",null,"联系邮箱"),e("th",null,"联系电话"),e("th",null,"注册时间"),e("th",null,"操作")])],-1)),e("tbody",null,[(s(!0),r(E,null,B(o.filteredSellers,t=>(s(),r("tr",{key:t.id},[e("td",null,m(t.id),1),e("td",null,m(t.username),1),e("td",null,m(t.registerEmail||"-"),1),e("td",null,m(t.registerPhone||"-"),1),e("td",null,m(o.formatDate(t.registerTime)),1),e("td",ke,[e("button",{class:"action-btn reset-btn",onClick:T=>o.showPasswordModal(t)}," 重置密码 ",8,be),e("button",{class:"action-btn delete-btn",onClick:T=>o.showDeleteModal(t)}," 删除 ",8,Ce)])]))),128))])]))])):f("",!0),o.showAddSellerModal?(s(),r("div",Pe,[e("div",Re,[l[34]||(l[34]=e("h3",null,"新增销售人员",-1)),e("div",Te,[l[30]||(l[30]=e("label",null,"用户名",-1)),b(e("input",{"onUpdate:modelValue":l[6]||(l[6]=t=>o.newSeller.username=t),placeholder:"请输入用户名"},null,512),[[C,o.newSeller.username]])]),e("div",Me,[l[31]||(l[31]=e("label",null,"密码",-1)),b(e("input",{type:"password","onUpdate:modelValue":l[7]||(l[7]=t=>o.newSeller.password=t),placeholder:"请输入密码"},null,512),[[C,o.newSeller.password]])]),e("div",Ae,[l[32]||(l[32]=e("label",null,"联系邮箱",-1)),b(e("input",{"onUpdate:modelValue":l[8]||(l[8]=t=>o.newSeller.registerEmail=t),placeholder:"请输入邮箱"},null,512),[[C,o.newSeller.registerEmail]])]),e("div",Ie,[l[33]||(l[33]=e("label",null,"联系电话",-1)),b(e("input",{"onUpdate:modelValue":l[9]||(l[9]=t=>o.newSeller.registerPhone=t),placeholder:"请输入手机号"},null,512),[[C,o.newSeller.registerPhone]])]),e("div",_e,[e("button",{class:"cancel-btn",onClick:l[10]||(l[10]=t=>o.showAddSellerModal=!1)},"取消"),e("button",{class:"confirm-btn",onClick:l[11]||(l[11]=(...t)=>o.addSeller&&o.addSeller(...t))},"确认添加")])]),e("div",{class:"modal-overlay",onClick:l[12]||(l[12]=t=>o.showAddSellerModal=!1)})])):f("",!0),o.showPasswordResetModal?(s(),r("div",Le,[e("div",De,[l[36]||(l[36]=e("h3",null,"重置密码",-1)),e("p",null,'为销售人员 "'+m((y=o.selectedSeller)==null?void 0:y.username)+'" 重置密码',1),e("div",Ee,[l[35]||(l[35]=e("label",null,"新密码",-1)),b(e("input",{type:"password","onUpdate:modelValue":l[13]||(l[13]=t=>o.newPassword=t),placeholder:"请输入新密码"},null,512),[[C,o.newPassword]])]),e("div",Be,[e("button",{class:"cancel-btn",onClick:l[14]||(l[14]=t=>o.showPasswordResetModal=!1)},"取消"),e("button",{class:"confirm-btn",onClick:l[15]||(l[15]=(...t)=>o.resetPassword&&o.resetPassword(...t))},"确认重置")])]),e("div",{class:"modal-overlay",onClick:l[16]||(l[16]=t=>o.showPasswordResetModal=!1)})])):f("",!0),o.showDeleteSellerModal?(s(),r("div",Ve,[e("div",xe,[l[37]||(l[37]=e("h3",null,"删除销售人员",-1)),e("p",null,'确定要删除销售人员 "'+m((P=o.selectedSeller)==null?void 0:P.username)+'" 吗？此操作不可撤销。',1),e("div",ze,[e("button",{class:"cancel-btn",onClick:l[17]||(l[17]=t=>o.showDeleteSellerModal=!1)},"取消"),e("button",{class:"confirm-btn delete-btn",onClick:l[18]||(l[18]=(...t)=>o.deleteSeller&&o.deleteSeller(...t))},"确认删除")])]),e("div",{class:"modal-overlay",onClick:l[19]||(l[19]=t=>o.showDeleteSellerModal=!1)})])):f("",!0),o.showCategoriesSalesReport?(s(),_(p,{key:4,onClose:l[20]||(l[20]=t=>o.showCategoriesSalesReport=!1)})):f("",!0),o.showCategoriesSalesReport?(s(),r("div",{key:5,class:"modal-overlay",onClick:l[21]||(l[21]=t=>o.showCategoriesSalesReport=!1)})):f("",!0),o.showProductSalesTrend?(s(),_(h,{key:6,onClose:l[22]||(l[22]=t=>o.showProductSalesTrend=!1)})):f("",!0),o.showProductSalesTrend?(s(),r("div",{key:7,class:"modal-overlay",onClick:l[23]||(l[23]=t=>o.showProductSalesTrend=!1)})):f("",!0)])}const Fe=D(ge,[["render",Ue],["__scopeId","data-v-b140f132"]]);export{Fe as default};
