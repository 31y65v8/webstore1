import{_ as z,r as h,h as D,o as O,c as r,a as t,b as w,i as p,n as A,F as y,e as N,t as n,u as F,f as P,g as l}from"./index-CyoWKuPL.js";const V={class:"paid-orders"},q={class:"header"},E={class:"refresh-container"},L=["disabled"],T={key:0,class:"loading"},j={key:1,class:"empty-state"},M={key:2,class:"orders-container"},R={class:"order-header"},H={class:"order-date"},J={class:"order-items"},K={class:"product-info"},Q=["src","alt"],U={class:"product-details"},W={class:"price"},X={class:"quantity"},Y={class:"item-actions"},Z=["onClick","disabled"],G={key:0,class:"fas fa-spinner fa-spin"},ss={key:1},es={class:"order-footer"},ts={class:"customer-info"},as={class:"order-total"},os={class:"total-price"},ns={key:3,class:"pagination"},rs=["disabled"],ls=["disabled"],ds=10,is={__name:"PaidOrderItem",setup(cs){const k=F(),c=h(!1),u=h([]),i=h(1),v=h(1),f=(e,s)=>{e.shipping=s},C=D(()=>{const e={};return u.value.forEach(s=>{e[s.orderId]||(e[s.orderId]=[]),e[s.orderId].push(s)}),e}),g=async(e=1)=>{c.value=!0;try{const s=localStorage.getItem("token");if(!s){k.push("/login");return}const o=await P.get("/api/orderItems/seller/paid",{params:{page:e,size:ds},headers:{Authorization:`Bearer ${s}`}});if(o.data&&o.data.code===200){console.log("返回的订单项数据:",o.data.data.records);const d=o.data.data||{};u.value=(d.records||[]).map(a=>({...a,shipping:!1})),i.value=Number(d.current)||1,v.value=Number(d.pages)||1}}catch(s){console.error("获取待发货订单失败:",s)}finally{c.value=!1}},I=async e=>{var s,o,d;if(!e.shipping&&confirm(`确认发货商品: ${e.productName}?`)){f(e,!0);try{const a=localStorage.getItem("token");if(!a)return;const _=await P.post(`/api/orderItems/seller/${e.id}/ship`,null,{headers:{Authorization:`Bearer ${a}`}});_.data&&_.data.code===200?(alert("发货成功！已通知顾客"),u.value=u.value.filter(B=>B.id!==e.id)):(alert("发货失败："+(((s=_.data)==null?void 0:s.msg)||"未知错误")),f(e,!1))}catch(a){console.error("发货失败:",a),alert("发货失败："+(((d=(o=a.response)==null?void 0:o.data)==null?void 0:d.msg)||a.message)),f(e,!1)}}},b=e=>Number(e).toFixed(2),S=e=>e?new Date(e).toLocaleString():"",$=e=>{const s=[];return e.provinceName&&s.push(e.provinceName),e.cityName&&s.push(e.cityName),e.districtName&&s.push(e.districtName),e.addressDetail&&s.push(e.addressDetail),s.join(" ")},m=e=>{e<1||e>v.value||(i.value=e,g(e))},x=()=>{k.back()};return O(()=>{g()}),(e,s)=>(l(),r("div",V,[t("div",q,[t("button",{class:"back-button",onClick:x},s[2]||(s[2]=[t("span",null,"←",-1),p(" 返回 ")])),s[4]||(s[4]=t("h1",null,"待发货订单",-1)),t("div",E,[t("button",{class:"refresh-button",onClick:g,disabled:c.value},[t("i",{class:A(["fas fa-sync-alt",{"fa-spin":c.value}])},null,2),s[3]||(s[3]=p(" 刷新 "))],8,L)])]),c.value?(l(),r("div",T," 加载中... ")):u.value.length===0?(l(),r("div",j," 暂无待发货订单 ")):(l(),r("div",M,[(l(!0),r(y,null,N(C.value,(o,d)=>(l(),r("div",{key:d,class:"order-card"},[t("div",R,[t("h3",null,"订单号: "+n(d),1),t("span",H,"下单时间: "+n(S(o[0].createTime)),1)]),t("div",J,[(l(!0),r(y,null,N(o,a=>(l(),r("div",{key:a.id,class:"order-item"},[t("div",K,[t("img",{src:a.productImage,alt:a.productName,class:"product-image"},null,8,Q),t("div",U,[t("h4",null,n(a.productName),1),t("p",W,"¥"+n(b(a.productPrice)),1),t("p",X,"数量: "+n(a.quantity),1)])]),t("div",Y,[t("button",{class:"ship-button",onClick:_=>I(a),disabled:a.shipping},[a.shipping?(l(),r("i",G)):(l(),r("span",ss,"发货"))],8,Z)])]))),128))]),t("div",es,[t("div",ts,[t("p",null,[s[5]||(s[5]=t("strong",null,"收货人:",-1)),p(" "+n(o[0].receiverName),1)]),t("p",null,[s[6]||(s[6]=t("strong",null,"联系方式:",-1)),p(" "+n(o[0].receiverPhone),1)]),t("p",null,[s[7]||(s[7]=t("strong",null,"地址:",-1)),p(" "+n($(o[0])),1)])]),t("div",as,[t("p",null,"共 "+n(o.length)+" 件商品",1),t("p",os,"总价: ¥"+n(b(o[0].totalPrice)),1)])])]))),128))])),u.value.length>0&&!c.value?(l(),r("div",ns,[t("button",{disabled:i.value===1,onClick:s[0]||(s[0]=o=>m(i.value-1))}," 上一页 ",8,rs),t("span",null,n(i.value)+" / "+n(v.value),1),t("button",{disabled:i.value===v.value,onClick:s[1]||(s[1]=o=>m(i.value+1))}," 下一页 ",8,ls)])):w("",!0)]))}},ps=z(is,[["__scopeId","data-v-35608d77"]]);export{ps as default};
