import{_ as S,r,o as x,c as s,a as e,b as I,w,v as $,d as z,F as h,e as _,t as o,f as D,g as n}from"./index-CyoWKuPL.js";const P={class:"browse-history"},H={class:"filter-container"},M={class:"date-range"},T={class:"product-filter"},U=["value"],A={key:0,class:"loading"},F={key:1,class:"empty-state"},L={key:2,class:"history-table"},E=["onClick"],j={class:"pagination"},q=["disabled"],G=["disabled"],J={key:3,class:"detail-modal"},K={class:"modal-content"},O={key:0},Q={class:"modal-actions"},R=10,W={__name:"ViewBrowseHistory",setup(X){const y=r(!1),b=r([]),B=r([]),d=r(1),v=r(1),c=r(""),p=r(""),f=r(""),m=r(!1),i=r(null),k=l=>l?new Date(l).toLocaleString():"",V=async()=>{try{const l=localStorage.getItem("token");if(!l)return;const t=await D.get("/api/product/seller/products",{headers:{Authorization:`Bearer ${l}`}});t.data&&t.data.data&&(B.value=t.data.data.records||[])}catch(l){console.error("获取商品列表失败:",l)}},g=async(l=1)=>{y.value=!0;try{const t=localStorage.getItem("token");if(!t)return;const a={page:l,size:R};c.value&&(a.startDate=c.value),p.value&&(a.endDate=p.value),f.value&&(a.productId=f.value);const u=await D.get("/api/browse/history",{params:a,headers:{Authorization:`Bearer ${t}`}});u.data&&u.data.data&&(b.value=u.data.data.records||[],d.value=Number(u.data.data.current)||1,v.value=Number(u.data.data.pages)||1)}catch(t){console.error("获取浏览历史失败:",t)}finally{y.value=!1}},C=l=>{l<1||l>v.value||(d.value=l,g(l))},N=async l=>{try{const t=localStorage.getItem("token");if(!t)return;const a=await D.get(`/api/browse/user/${l}`,{headers:{Authorization:`Bearer ${t}`}});a.data&&a.data.data&&(i.value=a.data.data,m.value=!0)}catch(t){console.error("获取用户详情失败:",t),alert("获取用户详情失败")}};return x(()=>{V(),g()}),(l,t)=>(n(),s("div",P,[t[14]||(t[14]=e("h2",null,"商品浏览记录",-1)),e("div",H,[e("div",M,[t[7]||(t[7]=e("label",null,"日期范围:",-1)),w(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a)},null,512),[[$,c.value]]),t[8]||(t[8]=e("span",null,"至",-1)),w(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=a=>p.value=a)},null,512),[[$,p.value]])]),e("div",T,[t[10]||(t[10]=e("label",null,"商品:",-1)),w(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>f.value=a)},[t[9]||(t[9]=e("option",{value:""},"全部商品",-1)),(n(!0),s(h,null,_(B.value,a=>(n(),s("option",{key:a.id,value:a.id},o(a.name),9,U))),128))],512),[[z,f.value]])]),e("button",{class:"search-btn",onClick:g},"查询")]),y.value?(n(),s("div",A," 加载中... ")):b.value.length===0?(n(),s("div",F," 暂无浏览记录 ")):(n(),s("div",L,[e("table",null,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"商品名称"),e("th",null,"用户ID"),e("th",null,"浏览时间"),e("th",null,"详细信息")])],-1)),e("tbody",null,[(n(!0),s(h,null,_(b.value,(a,u)=>(n(),s("tr",{key:u},[e("td",null,o(a.productName),1),e("td",null,o(a.userId),1),e("td",null,o(k(a.browseTime)),1),e("td",null,[e("button",{class:"detail-btn",onClick:Y=>N(a.userId)}," 查看用户详情 ",8,E)])]))),128))])]),e("div",j,[e("button",{disabled:d.value===1,onClick:t[3]||(t[3]=a=>C(d.value-1))}," 上一页 ",8,q),e("span",null,o(d.value)+" / "+o(v.value),1),e("button",{disabled:d.value===v.value,onClick:t[4]||(t[4]=a=>C(d.value+1))}," 下一页 ",8,G)])])),m.value?(n(),s("div",J,[e("div",K,[t[13]||(t[13]=e("h3",null,"用户浏览详情",-1)),i.value?(n(),s("div",O,[e("p",null,"用户ID: "+o(i.value.userId),1),e("p",null,"浏览商品数: "+o(i.value.browseCount),1),e("p",null,"首次浏览时间: "+o(k(i.value.firstBrowseTime)),1),e("p",null,"最近浏览时间: "+o(k(i.value.lastBrowseTime)),1),t[12]||(t[12]=e("h4",null,"商品浏览频率",-1)),e("ul",null,[(n(!0),s(h,null,_(i.value.products,(a,u)=>(n(),s("li",{key:u},o(a.productName)+": "+o(a.count)+"次 ",1))),128))])])):I("",!0),e("div",Q,[e("button",{onClick:t[5]||(t[5]=a=>m.value=!1)},"关闭")])]),e("div",{class:"modal-overlay",onClick:t[6]||(t[6]=a=>m.value=!1)})])):I("",!0)]))}},tt=S(W,[["__scopeId","data-v-2630579b"]]);export{tt as default};
